<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• AI Chess Battle - Claude vs GPT</title>
    
    <!-- Chess libraries -->
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #0a0a0a;
            color: #ffffff;
            padding: 15px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-size: 2.2em;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #ff6a00 50%, #ff4500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 106, 0, 0.5);
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr 350px;
            gap: 15px;
        }
        
        /* === TERMINAL (LEFT) === */
        .terminal-container {
            background: #000000;
            border: 2px solid #ff6a00;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 106, 0, 0.3);
            transition: border-color 0.3s;
        }
        
        .terminal-header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            padding: 10px 15px;
            border-bottom: 2px solid #ff6a00;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .dot-red { background: #ff4500; }
        .dot-yellow { background: #ffaa00; }
        .dot-green { background: #00ff00; }
        
        .terminal-title {
            flex: 1;
            text-align: center;
            color: #00ff00;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .terminal-body {
            height: 700px;
            overflow-y: auto;
            padding: 15px;
            background: #000000;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .terminal-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .terminal-body::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .terminal-body::-webkit-scrollbar-thumb {
            background: #ff6a00;
            border-radius: 4px;
        }
        
        .log-line {
            margin-bottom: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .log-success { color: #00ff00; }
        .log-error { color: #ff4444; }
        .log-warning { color: #ffaa00; }
        .log-info { color: #00aaff; }
        .log-debug { color: #888888; }
        .log-game { color: #ff6a00; font-weight: bold; }
        .log-move { color: #ffffff; }
        .log-thought { color: #aa00ff; font-style: italic; }
        
        /* === BOARD (CENTER) === */
        .board-container {
            background: #1a1a1a;
            border: 2px solid #333333;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        #board {
            width: 100%;
            max-width: 550px;
            margin: 0 auto;
        }
        
        .game-info {
            margin-top: 15px;
            text-align: center;
            background: #0a0a0a;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #333333;
        }
        
        .game-progress {
            margin-bottom: 10px;
        }
        
        .game-progress h3 {
            color: #ff6a00;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .progress-text {
            color: #ffffff;
            font-size: 0.95em;
            margin: 4px 0;
        }
        
        .turn-indicator {
            font-weight: bold;
            color: #00ff00;
        }
        
        .lichess-link {
            margin-top: 12px;
        }
        
        .lichess-link a {
            display: inline-block;
            padding: 8px 16px;
            background: linear-gradient(135deg, #ff6a00 0%, #ff4500 100%);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .lichess-link a:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 106, 0, 0.4);
        }
        
        /* === SIDEBAR (RIGHT) === */
        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .ai-thoughts-container {
            background: #1a1a1a;
            border: 2px solid #333333;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        .thoughts-title {
            color: #ff6a00;
            font-size: 1.2em;
            margin-bottom: 12px;
            text-align: center;
            font-weight: bold;
        }
        
        .thought-box {
            background: #0a0a0a;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        
        .thought-box:hover {
            transform: translateX(3px);
        }
        
        .thought-box:last-child {
            margin-bottom: 0;
        }
        
        .claude-thought {
            border-left: 4px solid #ffffff;
        }
        
        .gpt-thought {
            border-left: 4px solid #ff6a00;
        }
        
        .thought-header {
            margin-bottom: 6px;
        }
        
        .ai-name {
            font-weight: bold;
            font-size: 0.95em;
            color: #ffffff;
        }
        
        .thought-content {
            color: #cccccc;
            font-size: 0.85em;
            font-style: italic;
            margin-bottom: 5px;
            line-height: 1.3;
        }
        
        .thought-stats {
            color: #888888;
            font-size: 0.75em;
            font-family: 'Courier New', monospace;
        }
        
        .score-card {
            background: #1a1a1a;
            border: 2px solid #333333;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        .score-title {
            color: #ff6a00;
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 12px;
            font-weight: bold;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: #0a0a0a;
            border-radius: 6px;
            border-left: 3px solid transparent;
        }
        
        .score-item.claude {
            border-left-color: #ffffff;
        }
        
        .score-item.gpt {
            border-left-color: #ff6a00;
        }
        
        .score-item.draws {
            border-left-color: #666666;
        }
        
        .score-item.total {
            border-left-color: #00ff00;
            margin-top: 8px;
            font-weight: bold;
        }
        
        .score-label {
            color: #ffffff;
            font-size: 0.9em;
        }
        
        .score-value {
            background: linear-gradient(135deg, #ff6a00 0%, #ff4500 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.95em;
        }
        
        .info-card {
            background: #1a1a1a;
            border: 2px solid #333333;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        .info-title {
            color: #ff6a00;
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: bold;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #333333;
            font-size: 0.85em;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #888888;
        }
        
        .info-value {
            color: #ffffff;
            font-weight: bold;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }
        
        .status-waiting {
            background: #ffaa00;
            color: #000;
        }
        
        .status-playing {
            background: #00ff00;
            color: #000;
        }
        
        .status-finished {
            background: #666666;
            color: #fff;
        }
        
        /* Responsive */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            
            .terminal-container {
                order: 3;
            }
            
            .board-container {
                order: 1;
            }
            
            .stats-panel {
                order: 2;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• AI CHESS BATTLE - Claude vs GPT üî•</h1>
        
        <div class="main-content">
            <!-- TERMINAL (LEFT) -->
            <div class="terminal-container">
                <div class="terminal-header">
                    <div class="terminal-dot dot-red"></div>
                    <div class="terminal-dot dot-yellow"></div>
                    <div class="terminal-dot dot-green"></div>
                    <div class="terminal-title">üìü LIVE TERMINAL (Auto-refresh: 2s)</div>
                </div>
                <div class="terminal-body" id="terminal">
                    <div class="log-line log-info">üöÄ Terminal initialized...</div>
                    <div class="log-line log-info">‚è≥ Waiting for game data...</div>
                </div>
            </div>
            
            <!-- CHESSBOARD (CENTER) -->
            <div class="board-container">
                <div id="board"></div>
                
                <div class="game-info">
                    <div class="game-progress">
                        <h3>‚ö° Game Progress</h3>
                        <p class="progress-text">Move: <span id="move-number">0</span></p>
                        <p class="progress-text turn-indicator" id="turn-indicator">Waiting...</p>
                    </div>
                    
                    <div class="lichess-link">
                        <a id="lichess-link" href="https://lichess.org" target="_blank">
                            üîó View on Lichess.org
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- SIDEBAR (RIGHT) -->
            <div class="stats-panel">
                <div class="ai-thoughts-container">
                    <h3 class="thoughts-title">üí≠ AI Thoughts</h3>
                    
                    <div class="thought-box claude-thought">
                        <div class="thought-header">
                            <span class="ai-name">‚ö™ Claude (White)</span>
                        </div>
                        <div class="thought-content" id="claude-thought">Waiting for game to start...</div>
                        <div class="thought-stats" id="claude-stats">üìä Material: - | Threats: -</div>
                    </div>
                    
                    <div class="thought-box gpt-thought">
                        <div class="thought-header">
                            <span class="ai-name">üü† GPT (Black)</span>
                        </div>
                        <div class="thought-content" id="gpt-thought">Waiting for game to start...</div>
                        <div class="thought-stats" id="gpt-stats">üìä Material: - | Threats: -</div>
                    </div>
                </div>
                
                <div class="score-card">
                    <h3 class="score-title">üèÜ Scoreboard</h3>
                    
                    <div class="score-item claude">
                        <span class="score-label">‚ö™ Claude (White)</span>
                        <span class="score-value" id="claude-score">0</span>
                    </div>
                    
                    <div class="score-item gpt">
                        <span class="score-label">üü† GPT (Black)</span>
                        <span class="score-value" id="gpt-score">0</span>
                    </div>
                    
                    <div class="score-item draws">
                        <span class="score-label">‚öñÔ∏è Draws</span>
                        <span class="score-value" id="draws-score">0</span>
                    </div>
                    
                    <div class="score-item total">
                        <span class="score-label">üìä Total Games</span>
                        <span class="score-value" id="total-games">0</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <h3 class="info-title">‚ÑπÔ∏è Information</h3>
                    
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value"><span class="status-badge status-waiting" id="status-badge">Waiting</span></span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">Game #:</span>
                        <span class="info-value" id="game-number">-</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">Elapsed time:</span>
                        <span class="info-value" id="elapsed-time">0h 0min</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">Last move:</span>
                        <span class="info-value" id="last-move">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        var board = null;
        var game = new Chess();
        var lastLogCount = 0;
        
        // Initialize chessboard
        var config = {
            draggable: false,
            position: 'start',
            pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
        };
        board = Chessboard('board', config);
        
        // Parse log type from message
        function parseLogType(message) {
            if (message.includes('‚úÖ') || message.includes('successful')) return 'success';
            if (message.includes('‚ùå') || message.includes('Error') || message.includes('error')) return 'error';
            if (message.includes('‚ö†Ô∏è') || message.includes('Warning') || message.includes('Invalid')) return 'warning';
            if (message.includes('üîç') || message.includes('Debug')) return 'debug';
            if (message.includes('üéÆ') || message.includes('GAME') || message.includes('Game over')) return 'game';
            if (message.includes('‚ôüÔ∏è') || message.includes('plays') || message.includes('Move') || message.includes('turn')) return 'move';
            if (message.includes('üí≠') || message.includes('thinks')) return 'thought';
            if (message.includes('üèÅ') || message.includes('victory') || message.includes('wins')) return 'game';
            if (message.includes('‚è≥') || message.includes('Waiting')) return 'info';
            if (message.includes('üì§') || message.includes('challenges')) return 'info';
            return 'info';
        }
        
        // Load logs from logs.json with NO CACHE - FIXED VERSION
        function loadLogs() {
            fetch('logs.json?' + new Date().getTime(), {
                cache: 'no-store',
                headers: {
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                }
            })
                .then(response => response.json())
                .then(data => {
                    var terminal = document.getElementById('terminal');
                    
                    // FIXED: Detect if logs.json was reset (new game started)
                    if (data.logs && data.logs.length < lastLogCount) {
                        // Logs were reset - clear terminal and restart
                        terminal.innerHTML = '';
                        lastLogCount = 0;
                        console.log('üîÑ Logs reset detected - clearing terminal');
                    }
                    
                    if (data.logs && data.logs.length > lastLogCount) {
                        // Add only new logs
                        for (var i = lastLogCount; i < data.logs.length; i++) {
                            var logLine = document.createElement('div');
                            var logType = parseLogType(data.logs[i]);
                            logLine.className = 'log-line log-' + logType;
                            logLine.textContent = data.logs[i];
                            terminal.appendChild(logLine);
                        }
                        
                        lastLogCount = data.logs.length;
                        
                        // Auto-scroll to bottom with smooth animation
                        terminal.scrollTop = terminal.scrollHeight;
                        
                        // Visual feedback: flash the terminal border green when updated
                        var terminalContainer = document.querySelector('.terminal-container');
                        terminalContainer.style.borderColor = '#00ff00';
                        setTimeout(function() {
                            terminalContainer.style.borderColor = '#ff6a00';
                        }, 200);
                    }
                })
                .catch(error => {
                    console.log('Error loading logs:', error);
                });
        }
        
        // Load and update from game_state.json with NO CACHE
        function loadGameState() {
            fetch('game_state.json?' + new Date().getTime(), {
                cache: 'no-store',
                headers: {
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                }
            })
                .then(response => response.json())
                .then(data => {
                    // Update board
                    if (data.moves) {
                        game = new Chess();
                        var moves = data.moves.split(' ');
                        for (var i = 0; i < moves.length; i++) {
                            if (moves[i]) {
                                try {
                                    game.move(moves[i], {sloppy: true});
                                } catch(e) {
                                    console.log('Invalid move:', moves[i]);
                                }
                            }
                        }
                        board.position(game.fen());
                    }
                    
                    // Update move counter
                    var moveCount = data.moves ? data.moves.split(' ').length : 0;
                    document.getElementById('move-number').textContent = moveCount;
                    
                    // Update turn indicator
                    var turnText = game.turn() === 'w' ? "‚ö™ Claude's turn (White)" : "üü† GPT's turn (Black)";
                    if (game.game_over()) {
                        if (game.in_checkmate()) {
                            turnText = game.turn() === 'w' ? "üèÜ GPT wins by checkmate!" : "üèÜ Claude wins by checkmate!";
                        } else if (game.in_draw()) {
                            turnText = "‚öñÔ∏è Draw!";
                        } else if (game.in_stalemate()) {
                            turnText = "‚öñÔ∏è Stalemate!";
                        }
                    }
                    document.getElementById('turn-indicator').textContent = turnText;
                    
                    // Update scores
                    if (data.scores) {
                        document.getElementById('claude-score').textContent = data.scores.claude || 0;
                        document.getElementById('gpt-score').textContent = data.scores.gpt || 0;
                        document.getElementById('draws-score').textContent = data.scores.draws || 0;
                        document.getElementById('total-games').textContent = data.scores.total || 0;
                    }
                    
                    // Update AI thoughts
                    if (data.ai_thoughts) {
                        if (data.ai_thoughts.claude) {
                            document.getElementById('claude-thought').textContent = data.ai_thoughts.claude.thought || 'Analyzing...';
                            document.getElementById('claude-stats').textContent = 
                                'üìä Material: ' + (data.ai_thoughts.claude.material || '-') + 
                                ' | Threats: ' + (data.ai_thoughts.claude.threats || '-');
                        }
                        
                        if (data.ai_thoughts.gpt) {
                            document.getElementById('gpt-thought').textContent = data.ai_thoughts.gpt.thought || 'Analyzing...';
                            document.getElementById('gpt-stats').textContent = 
                                'üìä Material: ' + (data.ai_thoughts.gpt.material || '-') + 
                                ' | Threats: ' + (data.ai_thoughts.gpt.threats || '-');
                        }
                    }
                    
                    // Update info
                    if (data.game_url) {
                        document.getElementById('lichess-link').href = data.game_url;
                    }
                    
                    document.getElementById('game-number').textContent = data.game_num || '-';
                    document.getElementById('elapsed-time').textContent = data.elapsed_time || '0h 0min';
                    document.getElementById('last-move').textContent = data.last_move || '-';
                    
                    // Update status
                    var statusBadge = document.getElementById('status-badge');
                    if (game.game_over()) {
                        statusBadge.textContent = 'Finished';
                        statusBadge.className = 'status-badge status-finished';
                    } else if (data.moves && data.moves.length > 0) {
                        statusBadge.textContent = 'Playing';
                        statusBadge.className = 'status-badge status-playing';
                    } else {
                        statusBadge.textContent = 'Waiting';
                        statusBadge.className = 'status-badge status-waiting';
                    }
                })
                .catch(error => {
                    console.log('Error loading game state:', error);
                });
        }
        
        // Update every 2 seconds (as requested)
        setInterval(loadLogs, 2000);
        setInterval(loadGameState, 2000);
        
        // Initial load
        loadLogs();
        loadGameState();
    </script>
</body>
</html>
